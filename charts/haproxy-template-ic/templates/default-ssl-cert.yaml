{{- if and .Values.controller.defaultSSLCertificate.enabled .Values.controller.defaultSSLCertificate.create }}
{{- if and .Values.controller.defaultSSLCertificate.cert .Values.controller.defaultSSLCertificate.key }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.controller.defaultSSLCertificate.secretName }}
  namespace: {{ .Values.controller.defaultSSLCertificate.namespace | default .Release.Namespace }}
  labels:
    {{- include "haproxy-template-ic.labels" . | nindent 4 }}
  annotations:
    # Keep Secret on helm uninstall to preserve certificate across reinstalls
    # This ensures the Secret persists and can be reused if the chart is reinstalled
    "helm.sh/resource-policy": "keep"
type: kubernetes.io/tls
data:
  tls.crt: {{ .Values.controller.defaultSSLCertificate.cert | b64enc }}
  tls.key: {{ .Values.controller.defaultSSLCertificate.key | b64enc }}
{{- end }}
{{- end }}
