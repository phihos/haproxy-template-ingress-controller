# HAProxy Template Ingress Controller - Comprehensive Annotation Examples
# This file demonstrates all supported haproxy.org/* annotations
# Deploy with: kubectl apply -f ingress-demo.yaml
# Test with: ./scripts/test-routes.sh

---
# Supporting Resources - Basic Auth Secret
apiVersion: v1
kind: Secret
metadata:
  name: echo-auth-secret
  namespace: echo
type: Opaque
data:
  # Username: admin, Password: admin (bcrypt hash)
  # Generated with: htpasswd -nbB admin admin | cut -d: -f2 | base64 -w0
  admin: JDJ5JDA1JG1OMVdWazVRbmJnNFF3ZEFkWGJmei44YjNjZUg2UTVLT1ZDS3hSMklrTkFmSmdMaTVwSUtX
  # Username: user, Password: password (bcrypt hash)
  # Generated with: htpasswd -nbB user password | cut -d: -f2 | base64 -w0
  user: JDJ5JDA1JE9mazBoemZEQk5iTGV1alFNckNyQy50YW4xd1UwM25SNDYuUy52a2NXZ09oeXBQNnZHT1k2

---
##############################################################################
# 1. BASIC INGRESS - No annotations (baseline)
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-basic
  namespace: echo
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 2. BASIC AUTHENTICATION
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-auth
  namespace: echo
  annotations:
    haproxy.org/auth-type: "basic-auth"
    haproxy.org/auth-secret: "echo-auth-secret"
    haproxy.org/auth-realm: "Echo-Server-Protected"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-auth.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 3. CORS CONFIGURATION
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-cors
  namespace: echo
  annotations:
    haproxy.org/cors-enable: "true"
    haproxy.org/cors-allow-origin: "https://example.com"
    haproxy.org/cors-allow-methods: "GET, POST, PUT, DELETE, OPTIONS"
    haproxy.org/cors-allow-headers: "Content-Type, Authorization, X-Custom-Header"
    haproxy.org/cors-allow-credentials: "true"
    haproxy.org/cors-max-age: "3600"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-cors.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 4. RATE LIMITING
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-ratelimit
  namespace: echo
  annotations:
    haproxy.org/rate-limit-requests: "5"
    haproxy.org/rate-limit-period: "10s"
    haproxy.org/rate-limit-size: "100k"
    haproxy.org/rate-limit-status-code: "429"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-ratelimit.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 5. IP ACCESS CONTROL - Allowlist
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-allowlist
  namespace: echo
  annotations:
    # Allow only specific IPs/CIDRs (localhost and cluster internal)
    haproxy.org/allowlist: "127.0.0.1, 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-allowlist.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 6. IP ACCESS CONTROL - Denylist
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-denylist
  namespace: echo
  annotations:
    # Deny specific IPs (example - would deny 1.1.1.1)
    haproxy.org/denylist: "1.1.1.1, 8.8.8.8"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-denylist.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 7. REQUEST REDIRECT
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-redirect
  namespace: echo
  annotations:
    haproxy.org/request-redirect: "https://echo.localdev.me"
    haproxy.org/request-redirect-code: "302"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-redirect.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 8. HEADER MANIPULATION - Request Headers
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-headers-request
  namespace: echo
  annotations:
    haproxy.org/request-set-header: |
      X-Forwarded-Proto https
      X-Custom-Request custom-req-value
      X-Request-ID req-12345
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-headers-request.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 9. HEADER MANIPULATION - Response Headers
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-headers-response
  namespace: echo
  annotations:
    haproxy.org/response-set-header: |
      Strict-Transport-Security max-age=31536000
      X-Custom-Response custom-resp-value
      X-Frame-Options DENY
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-headers-response.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 10. SET HOST HEADER
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-sethost
  namespace: echo
  annotations:
    haproxy.org/set-host: "internal-api.example.svc.cluster.local"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-sethost.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 11. PATH REWRITE
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-rewrite
  namespace: echo
  annotations:
    # Rewrite /api/v1/* to /*
    haproxy.org/path-rewrite: "^/api/v1/(.*) /\\1"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-rewrite.localdev.me
      http:
        paths:
          - path: /api/v1
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 12. LOAD BALANCING ALGORITHM
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-loadbalance
  namespace: echo
  annotations:
    haproxy.org/load-balance: "leastconn"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-loadbalance.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 13. COOKIE PERSISTENCE (Sticky Sessions)
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-sticky
  namespace: echo
  annotations:
    haproxy.org/cookie-persistence: "SERVERID"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-sticky.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 14. TIMEOUTS CONFIGURATION
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-timeouts
  namespace: echo
  annotations:
    haproxy.org/timeout-server: "30s"
    haproxy.org/timeout-client: "60s"
    haproxy.org/timeout-connect: "10s"
    haproxy.org/timeout-http-request: "5s"
    haproxy.org/timeout-http-keep-alive: "2m"
    haproxy.org/timeout-queue: "15s"
    haproxy.org/timeout-tunnel: "1h"
    haproxy.org/timeout-check: "3s"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-timeouts.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 15. FORWARDED-FOR HEADER
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-forwardedfor
  namespace: echo
  annotations:
    haproxy.org/forwarded-for: "true"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-forwardedfor.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 16. REQUEST CAPTURE (Logging)
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-capture
  namespace: echo
  annotations:
    haproxy.org/request-capture: |
      User-Agent
      Referer
      Cookie
    haproxy.org/request-capture-len: "256"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-capture.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 17. CUSTOM HEALTH CHECKS
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-healthcheck
  namespace: echo
  annotations:
    haproxy.org/check: "true"
    haproxy.org/check-http: "GET /health"
    haproxy.org/check-interval: "10s"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-healthcheck.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 18. POD MAXCONN (Connection Limits)
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-maxconn
  namespace: echo
  annotations:
    haproxy.org/pod-maxconn: "100"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-maxconn.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 19. SOURCE IP HEADER (Behind CDN/Proxy)
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-srcip
  namespace: echo
  annotations:
    haproxy.org/src-ip-header: "CF-Connecting-IP"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-srcip.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 20. COMBINED ANNOTATIONS - Real-world example
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-combined
  namespace: echo
  annotations:
    # Security
    haproxy.org/auth-type: "basic-auth"
    haproxy.org/auth-secret: "echo-auth-secret"
    haproxy.org/allowlist: "10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16"
    # Rate limiting
    haproxy.org/rate-limit-requests: "100"
    haproxy.org/rate-limit-period: "1m"
    # Headers
    haproxy.org/response-set-header: |
      X-Frame-Options DENY
      X-Content-Type-Options nosniff
    # Performance
    haproxy.org/load-balance: "leastconn"
    haproxy.org/cookie-persistence: "SERVERID"
    haproxy.org/timeout-server: "30s"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-combined-ingress.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 21. BACKEND CONFIG SNIPPET - Raw HAProxy Configuration
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-backend-snippet
  namespace: echo
  annotations:
    haproxy.org/backend-config-snippet: |
      # Custom HAProxy backend configuration
      option httplog
      option http-keep-alive
      http-reuse safe
      # Custom ACL and routing
      acl is_api path_beg /api
      http-request set-header X-Backend-Type "api" if is_api
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-backend-snippet.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 22. SSL REDIRECT - Force HTTPS
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-ssl-redirect
  namespace: echo
  annotations:
    haproxy.org/ssl-redirect: "true"
    haproxy.org/ssl-redirect-code: "301"
    haproxy.org/ssl-redirect-port: "443"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-ssl-redirect.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 23. PROXY PROTOCOL - Preserve client connection info
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-proxy-protocol
  namespace: echo
  annotations:
    # Enable PROXY protocol v2 when connecting to backends
    # Points to haproxy-demo-backend which accepts PROXY protocol
    # and forwards plain HTTP to echo-server
    haproxy.org/send-proxy-protocol: "proxy-v2"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-proxy-protocol.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: haproxy-demo-backend
                port:
                  number: 8080

---
##############################################################################
# 24. BACKEND SSL/TLS - Use HTTPS to backend + HTTP/2
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-backend-ssl
  namespace: echo
  annotations:
    # Enable SSL/TLS when connecting to backend (for backends that require HTTPS)
    # Points to haproxy-demo-backend which accepts SSL/TLS connections
    # and forwards plain HTTP to echo-server
    # Note: Not using HTTP/2 to avoid health check timeout issues
    haproxy.org/server-ssl: "true"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-backend-ssl.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: haproxy-demo-backend
                port:
                  number: 8443

---
##############################################################################
# 25. SCALE SERVER SLOTS - Pre-allocate slots for dynamic scaling
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-scale-slots
  namespace: echo
  annotations:
    # Pre-allocate 20 server slots (allows scaling without HAProxy reload)
    haproxy.org/scale-server-slots: "20"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-scale-slots.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

##############################################################################
# 26. Backend mTLS (Mutual TLS to backend servers)
#
# Demonstrates using client certificates and CA verification for backend
# connections, enabling mutual TLS authentication between HAProxy and
# backend servers.
#
# Features:
# - server-ssl: Enable SSL/TLS to backend
# - server-ca: CA certificate for backend verification
# - server-crt: Client certificate for mTLS authentication
#
# Note: Secrets contain self-signed demo certificates. The echo-server
# backend does not support mTLS, so this demo only validates that the
# annotations are accepted and the HAProxy config is properly generated.
# In production, use real certificates and mTLS-capable backend servers.
#
# Access: http://echo-backend-mtls.localdev.me/
##############################################################################

# CA certificate for backend verification
---
apiVersion: v1
kind: Secret
metadata:
  name: backend-mtls-ca
  namespace: echo
type: Opaque
data:
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUREekNDQWZlZ0F3SUJBZ0lVTGJRKzlYeUFDbk9CS0xRZlhrMGFWeVlrWllzd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0Z6RVZNQk1HQTFVRUF3d01SR1Z0YnlCdFZFeFRJRU5CTUI0WERUSTFNVEV3T0RFM016SXlOVm9YRFRJMgpNVEV3T0RFM016SXlOVm93RnpFVk1CTUdBMVVFQXd3TVJHVnRieUJ0VkV4VElFTkJNSUlCSWpBTkJna3Foa2lHCjl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUFwdmdhNkl5cmRuN1pXUkI4UjJFZm9hSmF6Q1B5RjdObS9ZeVMKNk5RSVJhZzdCTVR1Z0RUTml5bmh2Mmx3TG14c2xyNmtncXdieEo0TkZETWRxK3pnVGNmbFFpRjE5N1lsbnlPVAovRzZPMVVNNitOLzQyMmpKYlFOeHI4bTh2TThVN0FkUXU0ek5MREtwZU9YbVo3c2ZWWDI3ZVNqUENmR2drWTl3CjI3c3JubXY4UzVGanVhRlBVbkxHSzBVUWhWRTlIcE5scC91cHhyUmQzOUNDOUFWZlN6WWUvNGNjay9yYVBoZDAKSkhCa1NEWDdmWkY5aE1UQXNsdHdUSGp4KzFQNHF4T3BFeGd6MHNTQ0dPVjNHRHRocmhKZndMaU5RZU1nQXdWawpzRWxUT095M2d1WGxVS3UxRVhvN1dnMTBOOXkzRjRyWURPa1p0c2loWVlOM3VvaEM3UUlEQVFBQm8xTXdVVEFkCkJnTlZIUTRFRmdRVWo4NWRiaXBQR2ZWMzVOeWJIdGlpd2NwNG9kRXdId1lEVlIwakJCZ3dGb0FVajg1ZGJpcFAKR2ZWMzVOeWJIdGlpd2NwNG9kRXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QU5CZ2txaGtpRzl3MEJBUXNGQUFPQwpBUUVBbCtXOUtLQ3hCOXpXQ1kxZ0t0TVJGU0FtRUNVODNwaDlrRVVMMnZJdklMLzBOMEJQZjFtWjV4S1BUL0hQClZYZE9YTFg5aTJGYi9xMndKSEtQNVNVYzBqaFVYK2NlVHA3TDhJNjdmWXpxYUd2cVIxY3dCQWh2eW9RV0U1NysKTkszRFo3L3NFT3BCNFdmR2hycEJiZ1FZUTVSb3h0c3A0aTV4UFJJaktha2tuZzJDdXg4bEpYT29sZ3ZIRm5FMgpBRys3Vit0d0JJbVhtUDNyRzB1QmliSVE4M1NmOUNmWG5IbEJqOVlJSUJ3MHE5Rk5Md2duai9CUkpwRXM0OERnCm9VUkZMd1VFWmxLTkZLWld2dGhMVTJrOGdteFQxc3dmd01BMW1zcmF4SUpCZEZMZkdDS1pWanpxWllRRFdPcHcKdjF4eC9sQmVVMDV5UVhxc3B6dU04THpyVFE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==

# Client certificate for mTLS authentication
---
apiVersion: v1
kind: Secret
metadata:
  name: backend-mtls-client-cert
  namespace: echo
type: kubernetes.io/tls
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURBRENDQWVpZ0F3SUJBZ0lVVVFFNHBtcy9lQnJKamM4WmVyclpyd3hNSW1Jd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0Z6RVZNQk1HQTFVRUF3d01SR1Z0YnlCdFZFeFRJRU5CTUI0WERUSTFNVEV3T0RFM016SXpPRm9YRFRJMgpNVEV3T0RFM016SXpPRm93R1RFWE1CVUdBMVVFQXd3T1ltRmphMlZ1WkMxamJHbGxiblF3Z2dFaU1BMEdDU3FHClNJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUUN3Nk5LemtqR1BJb0N4N1ZSUTQyNW5kNU1nZmZMZ1BGZDIKbGZLRTdQRCtwUUdiWTNwTW4zUk1Ha2FhSHh6NTlueGhyYjAzZVdUdmZ6YzJEV1hoc2tXRjJxMEFLRGxmbzRyUwptVTREUjVWYktwUS8xdkp5T01TMU1ZQW9yVU9CdzRQTHdGZ2E0c0ZvRXFTV25BWHJwWDcwUHVLOElDV0FWbFN5CmorNUVTTlFYQ0pnRkgzQzF4REFsVWM2ZkhCZTZyWFdlUTMvN2plbnpSK3VneGFQUUl6bERUNE4zUWFuekpxNmQKQUtCZXhWWjJKcGgzb3ZiUVBKbE1RSlpsOWpicThEb3JnOEE5NzBJNHNmWEQzeUFReFhRR3JIdm9FRTJvOHl1RAoyMThZeEJpMzdReXZiT1drcElUY3lybG5sdFJoaGNYZld3UERtMlN1OFpMMHQ3SjRtNTZkQWdNQkFBR2pRakJBCk1CMEdBMVVkRGdRV0JCUWtpZXJidGNidVJzRXJjdjRrZGtnTGY3Y2VOakFmQmdOVkhTTUVHREFXZ0JTUHpsMXUKS2s4WjlYZmszSnNlMktMQnluaWgwVEFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBYmJNOUhwdFhwRndsQU5qdgowZXNZODJqRjhaUWVsK1ZVY1ZhR00wcDlwaTJoZGZoU3A3Ry8xV0RSVEFiVDFKSXYzak1kdEVFdW1MeDlUTnRHCnFEMVUzdkhSdXliSHltUkZURThYUDNDUjJTbEFJcEMvN045N25GRmpGT2EwcEZwRS8weWhkRmpNWkZKUVR0dVAKOXFSNVJSbk9JaXZFSGEwOExXcXlTVml4WUQrY3B1TGFXTm9QVHVIdEM0WVgyenEvMG1yelV1a2RBQWx3anppMwpqd2V2NHNWT3RNWGJXZGhya1lxejBjQ1QrZ1NXbGNsY3FUZEFESFpyZTd5QVFKY1RNV08wMVlycmQ2M2dINUQzCmQ1cWdoOTRTTXdMcExyTkhvaEx2cGRKT01XT0VoV0RiNitaSGZwcnBhUWppMTlaa0JjT0ZTSjQ0aitPZk1IaS8KOGlYNUxRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQ3c2Tkt6a2pHUElvQ3gKN1ZSUTQyNW5kNU1nZmZMZ1BGZDJsZktFN1BEK3BRR2JZM3BNbjNSTUdrYWFIeHo1OW54aHJiMDNlV1R2ZnpjMgpEV1hoc2tXRjJxMEFLRGxmbzRyU21VNERSNVZiS3BRLzF2SnlPTVMxTVlBb3JVT0J3NFBMd0ZnYTRzRm9FcVNXCm5BWHJwWDcwUHVLOElDV0FWbFN5ais1RVNOUVhDSmdGSDNDMXhEQWxVYzZmSEJlNnJYV2VRMy83amVuelIrdWcKeGFQUUl6bERUNE4zUWFuekpxNmRBS0JleFZaMkpwaDNvdmJRUEpsTVFKWmw5amJxOERvcmc4QTk3MEk0c2ZYRAozeUFReFhRR3JIdm9FRTJvOHl1RDIxOFl4QmkzN1F5dmJPV2twSVRjeXJsbmx0UmhoY1hmV3dQRG0yU3U4WkwwCnQ3SjRtNTZkQWdNQkFBRUNnZ0VBSUdDME0yWlZ5SzhWWTdzZWUrRnNFdWE1R0RERTgxSkg1YTNDNFo0bDYwMFMKMHJndHFYbGpoUXdvRU13Ujl4T3NKd3B2djRmcHQ4V09Pc2ZQOWpNMDh5OFhDNWpSQzFaNHNWdWFnaEluWFRTWgpSbWZXSHA2U0xlRmQ1ZFAwTDNzemsyWmtHYU9YcHk4R1RZUkh0eDJtY3hoUlVnSUdLd3RoMi81b3FybXppM1ZhCm1EbXhJQ1hwSm1LK25ITzNUM0R3SXZhUWFGa0JydmkrQWxXNDRFVjkxdzBUcUdGK29VVmVTVzhCUHJmVUJvQkQKZ1JDVGdpQ09FVDFHV0UveVRyZ01RUEdUajlnQ2FJQzVRNFhkejFOS00yT2hIUzlER0dWTElHcDMrT0pQWjdaNwprbmNuZWJFbG5VU0RYenAvRHNxcENqaGQwSEliLzhNbnFLOWhQNkVFUVFLQmdRRGttNTZjQkZxa2hWYlBNYldhCnNOSG10UmUxMG9uYjg5dG8zdDArVUlWa3lpZzQ0YU9jcDFkMDF2WlhSTmxtbjRNdUNWbmVVR1dJVkRzdTBtNGQKUUgvUDhQSXZjY2FPTnpsT2c4cjZFOGIra3RkVWw0ZUQwMEJXeXpiRTJxSGRSN3h0azlqZTFSMW5xMFZrM1RlMgpFRjY4NThRbUlOcTZRMWpONEp6WkFLeU1ZUUtCZ1FER0cyUmFCQ1hwMDcxaFdHbS9rb01uUlZEUDVJbk05enJOCmxiT0dhNTd2Kzg2Z3FZR0VGaFFHSTE0TnNCeVAzTEdRN1VFR3hRTUVyZmw3ai9DVk9teEE3aGJVK0JlZmp3eE0KbjBiaWNhSEpVN3g0WG5sWjgyWmVacmNrTW5QNFd6a0RraVVqeEJCZGRacEdpTVlNMTIyVDN1VzNtSHo2S1RIdQpBZU5BaU1IYnZRS0JnRk9PbGRDTXZ0eTNaOTFmVy9Ob2diQURyT0RtVFVFNXhvNTBOd1daeE1mc0kvdDJiYWpLCmVXclpUenppaTF1NUhlZHJ2NDlFYjNmKzRZcmhteUhSKzJWenVmR2hjbU4weDl0c3pIblBWTUtqeFZURDllSTMKQ3FNdXI1d1FGVzJkMUw5d2RLb3Qxd3VYVEV2cmwzdFNURzViZ0JRM21mck90dHk1SmxzaXBlN0JBb0dBQmhzcQpDS3hBRHVqNzJWaEVTaWRWNjR2elpiVUJtbE8wZUVtNDh0ZTJXbWRFZ3ljMldyL2pkaHo0OVNzTWRsS3pGbWg1CnJKKzk3Qk1Bc1pKS05BOU03dU5ueU1DczJib3JBdUdWNmJ6ZTQ3bTFBWERJQk1HLzBnRVFmQWtpRWZHZDNFSlEKNnIxTVU5VWdJRFJ2Qms1TmpsVThkMkEzMmU0VEgrYm0va0k0MTNFQ2dZRUE1R0xWRU81K1JSVlJaZFhURzgwcwo1aHhDR1lkQ1IydUI4SWlmRTI0UTRlWDNoaHJwQk43em53UlQvK1JJM2RYclZ0OThKNCtXMnNETHVaemhBSlNwCnYydXUyVzdGdFh1SUV3TG9YSmR6VzBZSG0vSldJTlAvR0Nkd08vSzc1SGFWYVVpT3pId0F0akVBMXQzS2xzWCsKRThjMjJYVW1ZTG1vL0d0ZXJCZy9BMkE9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K

# Ingress using mTLS to backend
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-backend-mtls
  namespace: echo
  annotations:
    # Enable SSL/TLS to backend
    haproxy.org/server-ssl: "true"
    # CA certificate for verifying backend server certificate
    haproxy.org/server-ca: "backend-mtls-ca"
    # Client certificate for mTLS authentication
    haproxy.org/server-crt: "backend-mtls-client-cert"
    # Disable health checks since echo-server doesn't support SSL/mTLS
    haproxy.org/check: "false"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-backend-mtls.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 27. SSL PASSTHROUGH - TCP mode passthrough to HTTPS backend
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-ssl-passthrough
  namespace: echo
  annotations:
    # Enable SSL passthrough (SNI-based TCP routing)
    # HAProxy does not terminate SSL - passes encrypted traffic directly to backend
    # Backend must handle SSL/TLS termination
    haproxy.org/ssl-passthrough: "true"
spec:
  ingressClassName: haproxy-template-ic
  rules:
    - host: echo-passthrough.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: haproxy-demo-backend
                port:
                  number: 8443

---
##############################################################################
# 28. TLS TERMINATION - Basic single-host HTTPS
##############################################################################

# TLS Secret for single host
---
apiVersion: v1
kind: Secret
metadata:
  name: echo-tls-cert
  namespace: echo
type: kubernetes.io/tls
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURIekNDQWdlZ0F3SUJBZ0lVR1AyWUpEVCttcGFjN21rNFdPb09EdXRsd3Vrd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0h6RWRNQnNHQTFVRUF3d1VaV05vYnkxMGJITXViRzlqWVd4a1pYWXViV1V3SGhjTk1qVXhNVEl3TVRBeQpPVEV3V2hjTk1qWXhNVEl3TVRBeU9URXdXakFmTVIwd0d3WURWUVFEREJSbFkyaHZMWFJzY3k1c2IyTmhiR1JsCmRpNXRaVENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFOdzB1NmZoUkFXeG5Ta0YKWk1ZWXArcmxMTmg3WFRuaVo4QVFMdGxpdHBpRW9ncWdZMmVVUjJQbUZIbHpjKzE5U2k3T0ZWcVBVakxUR0JvdwpMcDNRVjFPVjZoN2JoMzdybHg2ZzJMd1lBRnJ6d2JRK04xTnRMRUQ5OWswTWlQODhLM1pESkpLUE1jYVJSamE4CndHb0dQUWZCdlRMSjZ1STBadE82aUFDZUZlZEJVLytubXZQTVg5OVg1NlA5bmpsdkthaXFKVXNkWGZlOE1xS1QKRkNjb25IQ3IwZWVmMXE4SHJZTHo2QUZoZ2tUNnpYb1BNeWpJMFIvS2ljbzNoOUIvbGU4RDdvQ0xHM3gxN3QwcQpna0xqN0xOY1IxSW9YSGxaQzJkYlE4dEVzWXFMd3hlaFhWZ0lVRmZtSjVSMm1tcU1sdmJ5U2dWdzRPYUErd0VQCmhucngvdkVDQXdFQUFhTlRNRkV3SFFZRFZSME9CQllFRkpMRjFmclZMMVp2akR5NWVqeWV1aUo0aEkrcU1COEcKQTFVZEl3UVlNQmFBRkpMRjFmclZMMVp2akR5NWVqeWV1aUo0aEkrcU1BOEdBMVVkRXdFQi93UUZNQU1CQWY4dwpEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBRDZPTVEvUDVJQ1puSlM2MXRhcmJab2NjMFhIMHp1alM4bUNtaXIrCkdDdVZtQThYVkl3Rnd0b2FBbU9XTkpGVlE2SnZXTnZIR25rTjZaWTVFcEtVeUZ1aSszdFpjQjNkTW9oZUZoUUIKMzE3NmZyNjBIVTBBeXdPVGJud3lRVWZtTm9KQ1NOb3A0NjZzNm1VNkI5TVRRWkMwYXZNcHlwcFFrN1lDb0gyUAprRVAwRmtJQklmUTIrVWozdzkvYkxjZHNXNVdJT3BnM3JFRGxPR1lmbDFhWVNrcjlqbkh2L2RlYXdMaUlvYzRsCnoxTkNlcWd1WmV0R2luTjFKNjZGZ2tjcjE2RHBKQnlKZ1grRlhtd2dxWEFHRUE0b2RiWXllZEtkRE9ORG9BZ1kKQkpGeEhJMjZ3QVk1OXNkNWVZYkFZd1F2alA5TUptR21SVmFmcFJ5ZmRHY0h3SFE9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2QUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktZd2dnU2lBZ0VBQW9JQkFRRGNOTHVuNFVRRnNaMHAKQldUR0dLZnE1U3pZZTEwNTRtZkFFQzdaWXJhWWhLSUtvR05ubEVkajVoUjVjM1B0ZlVvdXpoVmFqMUl5MHhnYQpNQzZkMEZkVGxlb2UyNGQrNjVjZW9OaThHQUJhODhHMFBqZFRiU3hBL2ZaTkRJai9QQ3QyUXlTU2p6SEdrVVkyCnZNQnFCajBId2IweXllcmlOR2JUdW9nQW5oWG5RVlAvcDVyenpGL2ZWK2VqL1o0NWJ5bW9xaVZMSFYzM3ZES2kKa3hRbktKeHdxOUhubjlhdkI2MkM4K2dCWVlKRStzMTZEek1veU5FZnlvbktONGZRZjVYdkErNkFpeHQ4ZGU3ZApLb0pDNCt5elhFZFNLRng1V1F0blcwUExSTEdLaThNWG9WMVlDRkJYNWllVWRwcHFqSmIyOGtvRmNPRG1nUHNCCkQ0WjY4Zjd4QWdNQkFBRUNnZ0VBRVczbUZZTmR1aktrL1JoMWNiMkZXdkVCUS9BOXdJVmtUMTRvaXlIR1VKdWMKNU1qdG5VYnVBS0QzS1diRE8vNnc5clB1bWtDaVVhNEdLQnA4c2hhSnR1NjBmWFZFUy80ek02UXBDM2c5M1BVUwp0YVRBQmMwc0ZjZlVMU1NMR21LbGtRSisvRSt6c2FNUmd1Y2ROcmNnTVFNN2FhLzBOS3ZQb0w0UW9qWGhCM0R0CmJvYVFZRXFiNUUzT3JPbXFtSnJJb3h5aFNOOGxhWS9lMW5OR2diMXV6eVFkVUxid0NRSkovd1VmOE45OW9xZFUKR3JvQTluR3NSSW50QVpJL0xnL0tYOG9hVmZaNDMwR3pjOHJwTmt6T1NNdmx6TVhFQkkwZWZpY1hSUFhpYkpPbwpaYzF5TXErMW15MDlEdmV1N2ZwWjRaU3VsbkxVNnZTUndiNzF4OXhlVVFLQmdRRDBUT1Z4MHZNNGxKeTYwY2pYClU2ZUZNMkFNLzZsa1YvTGdOUjFHR1U4aG9OemlIRGMrcnBSVHpBbmtMcFU5VTdnaitsd3VRT3Raby9nQ01kMWkKQU9vZy9uR0lKM1p2QlNjbTZWSUhFbWkycTFGMXZDeVZnRHl3Y09YNituYmJ4cGN1VXVCUXJDUTN6VjliQ0xDZQp0UmVVS05KTTFwemtobVlWT0NxeVZTMGNtUUtCZ1FEbXdIRUJxcGI5QnNPUTN2aXRxbHFabmtaMTEwaEk1Y1AvCk40elVZZmo5Q1B4MEdrOUFhdFpHbk1ucDNWQXZxaWlhbmRYbXlwZkNYVk5scy9PMHFCMitzU2Z0ODNtVTRIOVkKWVh6Q3ZUSFZTTmd3L0o2ZnI0NjUwLzUvb1c1YmZHcDcyUTdIVFEzRmRvalBraW95ZE9kSGxJcG9aS21aYVRMaQphY3RzYm1oVUdRS0JnQmNHbkdXakRWdWEzajdaZ1FXU2srcUJFaCtIaFU2NDMySjBmeUxaUmRVVWxWMFdiYnFSCnQ5ZENGdmlUejJzdFZlREdPeVA4NkhIVmU0MnhaMzFTT3I4TFhHWUoyaWJTcElNTllMYmI3RlN6UndWQ3pDejMKSGtFL0V0NFo5MVAxbnRBMTdZQ05DUWpkYVl4cUFFT2xLK2pDQkRoTHpoUFgrdzBxOHhORjVlK1pBb0dBV3d0ZgpDeXRGdTd2cGVjV2dGTlY4UGRSbk5LT21qNnlvY3BCMmJtM2hrZVR6eHRPQ3BZWUIyWWFQWEVqSUZLWnNzdVRICnV2SUFndDNUdy9NR215Y2g1VlY4emJRZEtwS1JiRXU2c0JONkVBOVh6YXcrNGY2Z3I4MW5RdkJzM0lmd2M4RW0KeFpndmNOUGVFeGcyc2dYU0l6b0dpajM5ZE53L0NYcDRtdVhOSURFQ2dZQUdpYm1nRmp5SkQwYnNsY0RIVDVoSQpSUTU5ZXZjQWV5cVAvSmc1UkVlNWVNOXFKclY5ZVdoMXpwRjZlU0pqNUlQMnp2OTBtQm5QRi9RWmMvM2QzMDBGCkFxNVVTS2pGWS9kUDJoblNsT1BnNGRqVmM0dkV5WWxxNUN4cUdWbHVXbmJ4YjFSMGpGeVRhSDEwNkpxRWtScnkKam82TGFZKzRRWHhlblcwSGtRc0F5dz09Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K

# Ingress with basic TLS termination
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-tls
  namespace: echo
spec:
  ingressClassName: haproxy-template-ic
  tls:
    - hosts:
        - echo-tls.localdev.me
      secretName: echo-tls-cert
  rules:
    - host: echo-tls.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 29. TLS TERMINATION - Multi-host with SAN certificate
##############################################################################

# TLS Secret for multiple hosts (SAN certificate)
---
apiVersion: v1
kind: Secret
metadata:
  name: echo-tls-multi-cert
  namespace: echo
type: kubernetes.io/tls
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURiakNDQWxhZ0F3SUJBZ0lVRDF3RUNZd3BXcVgxTjVaOTJTMWd0UWxhSHA4d0RRWUpLb1pJaHZjTkFRRUwKQlFBd0pURWpNQ0VHQTFVRUF3d2FaV05vYnkxMGJITXRiWFZzZEdrdWJHOWpZV3hrWlhZdWJXVXdIaGNOTWpVeApNVEl3TVRBeU9URXlXaGNOTWpZeE1USXdNVEF5T1RFeVdqQWxNU013SVFZRFZRUUREQnBsWTJodkxYUnNjeTF0CmRXeDBhUzVzYjJOaGJHUmxkaTV0WlRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUIKQUtCUjBPT1o5UUVNb1dUSnJMV3BBU1lGVTg3R25qb3psQ1BOT093cVFpMGx1UGhBdDdZU2xPcEJ2Q0NxV2VVRApIanZTdzVCUU4waFI5WndTcXA2a01tUWs2RW45Sm9QL0JsUXl4aXViZHVaNXM0a0VZeGdiOEFwQ0YwVStGeTJlCm4vZElRYnN6b2daQnJsRmQ0RjdDdW40cE5SYk80aEkrSjdJRkRtQmIwcVZQSDl0S1ZnMGZ4dmRPaVphb0M1cCsKWk5WVXNyR1Y3Lzl2UVROdmx0eFgvTGlTbUdYeWZVZjRDcEFMWm9xR0J0dUs1ZVVYQXEzWkVvelI0NGd0SFBxcAo1MkFESUVJanZiMWRSQitDdTVoWmIyb2dHeTF3UVljRjNBS05zeHR0SEJhUEhlSk1qK3VLMUpFb2YxbnhxQUFhCmZ6Ujk3WGFOcFlYN0NwOFFFWlR2UzIwQ0F3RUFBYU9CbFRDQmtqQWRCZ05WSFE0RUZnUVVlYkZBK1daMG9rYk8KN2VkNjMvZWE2ZWU0TGk4d0h3WURWUjBqQkJnd0ZvQVVlYkZBK1daMG9rYk83ZWQ2My9lYTZlZTRMaTh3RHdZRApWUjBUQVFIL0JBVXdBd0VCL3pBL0JnTlZIUkVFT0RBMmdocGxZMmh2TFhSc2N5MXRkV3gwYVM1c2IyTmhiR1JsCmRpNXRaWUlZWldOb2J5MTBiSE10WVd4MExteHZZMkZzWkdWMkxtMWxNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUIKQVFBUTVoc0pXN2VaQnNhR0MxZzJLVnZXVkU1Y1JycHkwdGVUV0lLSHJpVGJPdUxWN3AzcVlNS1VBckhQNWRTcwo3bXpjTER0YmF0Slh5VmQ4L21kWUwvMndRWEVMcUVZSDhCNXNUUzVHYzNZSEZDck1uWG1lRWJxODdmams5TURSCndFRGlKWHQ3VlhaSm9QZTFVeGJrQVhGTWtVQmM5bmhiYTFvWjd3eWdZblo0YUIyVlNTdnFvWEJzY1M4eC9YQVcKdCtuSjhhb2thQ3dvaitKdFdDOFpROWZEaS85REtMWHZHYmV1Rk0xSkFob0JiYk5EQUQxSy93Qm1pZ0JhTWs5dwpPcUh1aGpFU0tmdlppUDUyL2tBLytUTnhPTlYyS2QwOWpXQlNuMzd5dGxkemhrTkNTREY4b0NUWFpTbzV0K0V4CjRCK05HSFVadUlRaiszd0k3Mncvdk1wSQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2QUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktZd2dnU2lBZ0VBQW9JQkFRQ2dVZERqbWZVQkRLRmsKeWF5MXFRRW1CVlBPeHA0Nk01UWp6VGpzS2tJdEpiajRRTGUyRXBUcVFid2dxbG5sQXg0NzBzT1FVRGRJVWZXYwpFcXFlcERKa0pPaEovU2FEL3daVU1zWXJtM2JtZWJPSkJHTVlHL0FLUWhkRlBoY3RucC8zU0VHN002SUdRYTVSClhlQmV3cnArS1RVV3p1SVNQaWV5QlE1Z1c5S2xUeC9iU2xZTkg4YjNUb21XcUF1YWZtVFZWTEt4bGUvL2IwRXoKYjViY1YveTRrcGhsOG4xSCtBcVFDMmFLaGdiYml1WGxGd0t0MlJLTTBlT0lMUno2cWVkZ0F5QkNJNzI5WFVRZgpncnVZV1c5cUlCc3RjRUdIQmR3Q2piTWJiUndXangzaVRJL3JpdFNSS0g5WjhhZ0FHbjgwZmUxMmphV0Yrd3FmCkVCR1U3MHR0QWdNQkFBRUNnZ0VBRWdicEkzS2dJVmhUZkpNTjI5WnZaZUJTK20wTWhUUmdDNytMajBpNExMM3gKWk43WUdYM1E1MTl4WVVYdWVra2x1T25iNmlvTzhVK2YrOGNBanZxZEhQUW1kNDFpNjVROVdMSGw1U2pqejRvdgpSVENzV04xcFdpbncxbTBqSzVMSzM0SXRPL2pVRnZxRE9LeUM2bnpnZmdleHE4a2pGQlNQbjUyZ2JuYmN3cEFyCnl1V013UUNPZHE3K3VSL0w2Um9VN09MQ054SzdzUVJUUDMzcXlKaGFrOWhVVFNITUgrWDhMNEw4Q25FR1R4bCsKS0doVWp2NDdBb0k0aFZLc0JiKzJUQ2RxZHptWDFaRCs4eGh1a3RaQ05IN0tiQWd5QjA5cmYwUko5NnpsdGdPNwpsTW9CenNpSGF3ZnFOdmJlbFAyTnBtTVEzWmhJcE14S0dYL1FWekFZa1FLQmdRRFF4WFl5WGJQZ0ZyMnFxdFdJCmw4SU5vTERTSk1WK0FrVEdxdkd6RzR4cXNpNWJoNENFSEtOUlFydGNmWndGSzUraDlTSTNyTG9NMlZlU2JtbXQKZnRYWVVLVWd4Rk9oRlUxdkRCVzJLeGdKazdwbTdJRzVJR2ZqV1BRamppMWhkVmd6UXAzWGxnRDAyS0N1OEczSQphRE12Z25ZcEtDZEJDM3MwZDdEdmhqYXRmUUtCZ1FERWxtQi9OQVNaSFVxQWFPUDV2a1l4U2dodktNYkx4OG41CksvTThxSWl4SXE1VXM0RWkrcjZtRG9aWDFXR3c0VXh5aEZ5R1VISTdDd202RWxCY0FhL09uN25sVDQ1VTZTSkEKaWFOUDh5bWVGcUUyL2J2ZlpVcEVEcEU5eHdxNHFVK0dsV0VjSVFsTVRkT3psVUhadGNISjBvRDJWVndsR0M2SQptUVhwWDBZNHNRS0JnQTVhcFVmTlBZTFl6VzJnbFZIdzdUeTJvYkd4S1lzQ2FPd244THBaMkl1MWVJNStnSTJVCjBuM1Iwc1FITnVUOEhOdXIyUkJ1NWRQZ1ZhOFJ2RjViYkNTVlZ1VXIybndtMU00ZnpKWmIzQ2s4YVFLT25GUzQKTDZ4bi8xRTZnMUJDR3pCYkVqTXljeHBpa3BtMG1qZS9RbFd2NktQbnlOc21DUENRa2kvRjBKaVpBb0dBU2plVAplcktDd2VPREN2T09qZXk5eDBIeDZUVjF4OTFIYlNDZ2xkZnlzeDBxdjZOOUwxMkd1RjVuYmFXTFdpSFVvSzlECjF4bHI1c3FHQTQrQ2N4blg2NlAxcEpMaVkwQVl4RkN5TFM3YUdXcmx0a01ZdUlBZkI0NlFXc2hZVGRydHdSdUkKSy94MDdDKzlxdURBbVphNjhKemVQeUYreGlwWTl3eitaRnFwd2lFQ2dZQkpNclRPaloyWHM4Ti8xUkJsU2N3RApoczRlQVJhT211ZHVsRHNMd0tLVzRGZmNZTnVhbWhiLzROUlU4OWVSYXp5K2VBS1JodjdZQ1lXUVBsRlZBaFhyClVtZnBMeFcvdnVTVEpEWVhyd0doQ09QMHdKWnd2ZXlFOERkWlF4WTJJMCs1Vy9uUjl5bVdidWhEaG5WOGY2bFoKZ0ZrcnBUd2ttUy9ialp0bFk0SndRUT09Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K

# Ingress with multi-host TLS (SAN certificate)
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-tls-multi
  namespace: echo
spec:
  ingressClassName: haproxy-template-ic
  tls:
    - hosts:
        - echo-tls-multi.localdev.me
        - echo-tls-alt.localdev.me
      secretName: echo-tls-multi-cert
  rules:
    - host: echo-tls-multi.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80
    - host: echo-tls-alt.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80

---
##############################################################################
# 30. TLS TERMINATION - Combined with other annotations
##############################################################################
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-tls-combined
  namespace: echo
  annotations:
    # Force HTTPS redirect for HTTP requests
    haproxy.org/ssl-redirect: "true"
    haproxy.org/ssl-redirect-code: "301"
    # Add security headers
    haproxy.org/response-set-header: |
      Strict-Transport-Security max-age=31536000; includeSubDomains
      X-Frame-Options DENY
      X-Content-Type-Options nosniff
spec:
  ingressClassName: haproxy-template-ic
  tls:
    - hosts:
        - echo-tls-combined.localdev.me
      secretName: echo-tls-cert
  rules:
    - host: echo-tls-combined.localdev.me
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80
